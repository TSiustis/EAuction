CKEDITOR.plugins.add("preview",{lang:"af,ar,az,bg,bn,bs,ca,cs,cy,da,de,de-ch,el,en,en-au,en-ca,en-gb,eo,es,es-mx,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,oc,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"preview,preview-rtl",hidpi:!0,init:function(e){e.addCommand("preview",{modes:{wysiwyg:1},canUndo:!1,readOnly:1,exec:CKEDITOR.plugins.preview.createPreview}),e.ui.addButton&&e.ui.addButton("Preview",{label:e.lang.preview.preview,command:"preview",toolbar:"document,40"})}}),CKEDITOR.plugins.preview={createPreview:function(e){var t,n,i,a,o,r,l,d,s,c={dataValue:(t=e,r=CKEDITOR.plugins.getPath("preview"),l=t.config,d=t.lang.preview.preview,n=location.origin,i=location.pathname,s=l.baseHref||CKEDITOR.env.gecko?l.baseHref?'<base href="{HREF}">'.replace("{HREF}",l.baseHref):((i=i.split("/")).pop(),i=i.join("/"),'<base href="{HREF}">'.replace("{HREF}",n+i+"/")):"",l.fullPage?t.getData().replace(/<head>/,"$&"+s).replace(/[^>]*(?=<\/title>)/,"$& &mdash; "+d):l.docType+'<html dir="'+l.contentsLangDirection+'"><head>'+s+"<title>"+d+"</title>"+CKEDITOR.tools.buildStyleHtml(l.contentsCss)+'<link rel="stylesheet" media="screen" href="'+r+'styles/screen.css"></head>'+(a="<body>",(o=t.document&&t.document.getBody())&&(o.getAttribute("id")&&(a=a.replace(">",' id="'+o.getAttribute("id")+'">')),o.getAttribute("class")&&(a=a.replace(">",' class="'+o.getAttribute("class")+'">'))),a)+t.getData()+"</body></html>")},u=window.screen,p=Math.round(.8*u.width),w=Math.round(.7*u.height),h=Math.round(.1*u.width),u=CKEDITOR.env.ie?"javascript:void( (function(){document.open();"+("("+CKEDITOR.tools.fixDomain+")();").replace(/\/\/.*?\n/g,"").replace(/parent\./g,"window.opener.")+"document.write( window.opener._cke_htmlToLoad );document.close();window.opener._cke_htmlToLoad = null;})() )":null,g=CKEDITOR.plugins.getPath("preview");return g=CKEDITOR.env.gecko?CKEDITOR.getUrl(g+"preview.html"):"",!1!==e.fire("contentPreview",c)&&((u||g)&&(window._cke_htmlToLoad=c.dataValue),e=window.open(g,null,["toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes","width="+p,"height="+w,"left="+h].join()),u&&e&&(e.location=u),window._cke_htmlToLoad||((p=e.document).open(),p.write(c.dataValue),p.close()),new CKEDITOR.dom.window(e))}};