CKEDITOR.dialog.add("specialchar",function(g){function l(e){var t;"a"==(e=e.data?e.data.getTarget():new CKEDITOR.dom.element(e)).getName()&&(t=e.getChild(0).getHtml())&&(e.removeClass("cke_light_background"),o.hide(),(e=g.document.createElement("span")).setHtml(t),g.insertText(e.getText()))}function i(e,t){var n,a;"span"==(t=t||e.data.getTarget()).getName()&&(t=t.getParent()),"a"==t.getName()&&(n=t.getChild(0).getHtml())&&(r&&s(null,r),a=o.getContentElement("info","htmlPreview").getElement(),o.getContentElement("info","charPreview").getElement().setHtml(n),a.setHtml(CKEDITOR.tools.htmlEncode(n)),t.getParent().addClass("cke_light_background"),r=t)}var o,r,d=g.lang.specialchar,u=CKEDITOR.tools.addFunction(l),s=function(e,t){"span"==(t=t||e.data.getTarget()).getName()&&(t=t.getParent()),"a"==t.getName()&&(o.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),o.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),t.getParent().removeClass("cke_light_background"),r=void 0)},p=CKEDITOR.tools.addFunction(function(e){var t=(e=new CKEDITOR.dom.event(e)).getTarget(),n=e.getKeystroke(),a="rtl"==g.lang.dir;switch(n){case 38:(n=t.getParent().getParent().getPrevious())&&((n=n.getChild([t.getParent().getIndex(),0])).focus(),s(null,t),i(null,n)),e.preventDefault();break;case 40:(n=t.getParent().getParent().getNext())&&(n=n.getChild([t.getParent().getIndex(),0]))&&1==n.type&&(n.focus(),s(null,t),i(null,n)),e.preventDefault();break;case 32:l({data:e}),e.preventDefault();break;case a?37:39:(n=t.getParent().getNext())?1==(n=n.getChild(0)).type?(n.focus(),s(null,t),i(null,n),e.preventDefault(!0)):s(null,t):(n=t.getParent().getParent().getNext())&&((n=n.getChild([0,0]))&&1==n.type?(n.focus(),s(null,t),i(null,n),e.preventDefault(!0)):s(null,t));break;case a?39:37:(n=t.getParent().getPrevious())?((n=n.getChild(0)).focus(),s(null,t),i(null,n),e.preventDefault(!0)):(n=t.getParent().getParent().getPrevious())?((n=n.getLast().getChild(0)).focus(),s(null,t),i(null,n),e.preventDefault(!0)):s(null,t)}});return{title:d.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){for(var e,t,n=this.definition.charColumns,a=g.config.specialChars,l=CKEDITOR.tools.getNextId()+"_specialchar_table_label",i=['<table role="listbox" aria-labelledby="'+l+'" style="width: 320px; height: 100%; border-collapse: separate;" align="center" cellspacing="2" cellpadding="2" border="0">'],o=0,r=a.length;o<r;){i.push('<tr role="presentation">');for(var s,c=0;c<n;c++,o++){(e=a[o])&&(e instanceof Array?(t=e[1],e=e[0]):(t=e.replace("&","").replace(";","").replace("#",""),t=d[t]||e),s="cke_specialchar_label_"+o+"_"+CKEDITOR.tools.getNextNumber(),i.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(o+1)+'"',' aria-setsize="'+r+'"',' aria-labelledby="'+s+'"',' class="cke_specialchar" title="',CKEDITOR.tools.htmlEncode(t),'" onkeydown="CKEDITOR.tools.callFunction( '+p+', event, this )" onclick="CKEDITOR.tools.callFunction('+u+', this); return false;" tabindex="-1"><span style="margin: 0 auto;cursor: inherit">'+e+'</span><span class="cke_voice_label" id="'+s+'">'+t+"</span></a></td>"))}i.push("</tr>")}i.push("</tbody></table>",'<span id="'+l+'" class="cke_voice_label">'+d.options+"</span>"),this.getContentElement("info","charContainer").getElement().setHtml(i.join(""))},contents:[{id:"info",label:g.lang.common.generalTab,title:g.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:i,onMouseout:s,focus:function(){var e=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){e.focus(),i(null,e)},0)},onShow:function(){var e=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){e.focus(),i(null,e)},0)},onLoad:function(e){o=e.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"}]}]}]}]}]}});