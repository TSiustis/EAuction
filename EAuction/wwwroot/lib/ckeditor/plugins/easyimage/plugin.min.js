!function(){function c(e){return CKEDITOR.tools.capitalize(e,!0)}function u(o,e){function r(s){return function(e,a){var t=e.widgets.focused,i=CKEDITOR.TRISTATE_DISABLED;t&&"easyimage"===t.name&&(i=s&&s.call(this,t,e,a)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),this.setState(i)}}o.addCommand("easyimageAlt",new CKEDITOR.dialogCommand("easyimageAlt",{startDisabled:!0,contextSensitive:!0,refresh:r()})),function(a){function t(e,a){var t=e.match(/^easyimage(.+)$/);if(t){var i=(t[1][0]||"").toLowerCase()+t[1].substr(1);if(t[1]in a)return t[1];if(i in a)return i}}for(var e in o.on("afterCommandExec",function(e){t(e.data.name,a)&&(o.forceNextSelectionCheck(),o.selectionChange(!0))}),o.on("beforeCommandExec",function(e){t(e.data.name,a)&&e.data.command.style.checkActive(e.editor.elementPath(),o)&&(e.cancel(),o.focus())}),a)i=o,n=a[s=e],l="easyimage"+c(e),n.type="widget",n.widget="easyimage",n.group=n.group||"easyimage",n.element="figure",s=new CKEDITOR.style(n),i.filter.allow(s),(s=new CKEDITOR.styleCommand(s)).contextSensitive=!0,s.refresh=r(function(e,a,t){return this.style.checkActive(t,a)}),i.addCommand(l,s),(s=i.getCommand(l)).enable=function(){},s.refresh(i,i.elementPath());var i,s,n,l}(e)}function f(a){var t=a.sender.editor,e=t.config.easyimage_toolbar;e.split&&(e=e.split(",")),CKEDITOR.tools.array.forEach(e,function(e){e=t.ui.items[e],a.data[e.name]=t.getCommand(e.command).state})}var a=!1,p=["jpeg","png","gif","bmp"];CKEDITOR.plugins.easyimage={_parseSrcSet:function(e){var a,t=[];for(a in e)"default"!==a&&t.push(e[a]+" "+a+"w");return t.join(", ")}},CKEDITOR.plugins.add("easyimage",{requires:"imagebase,balloontoolbar,button,dialog,cloudservices",lang:"ar,az,bg,cs,da,de,en,en-au,et,fa,fr,gl,hr,hu,it,ku,lv,nb,nl,no,pl,pt,pt-br,ro,ru,sk,sq,sr,sr-latn,sv,tr,tt,uk,zh,zh-cn",icons:"easyimagefull,easyimageside,easyimagealt,easyimagealignleft,easyimagealigncenter,easyimagealignright,easyimageupload",hidpi:!0,onLoad:function(){CKEDITOR.dialog.add("easyimageAlt",this.path+"dialogs/easyimagealt.js")},isSupportedEnvironment:function(){return!CKEDITOR.env.ie||11<=CKEDITOR.env.version},init:function(e){this.isSupportedEnvironment()&&(a||(CKEDITOR.document.appendStyleSheet(this.path+"styles/easyimage.css"),a=!0),e.addContentsCss&&e.addContentsCss(this.path+"styles/easyimage.css"))},afterInit:function(e){if(this.isSupportedEnvironment()){var a=CKEDITOR.tools.object.merge({full:{attributes:{class:"easyimage-full"},label:e.lang.easyimage.commands.fullImage},side:{attributes:{class:"easyimage-side"},label:e.lang.easyimage.commands.sideImage},alignLeft:{attributes:{class:"easyimage-align-left"},label:e.lang.common.alignLeft},alignCenter:{attributes:{class:"easyimage-align-center"},label:e.lang.common.alignCenter},alignRight:{attributes:{class:"easyimage-align-right"},label:e.lang.common.alignRight}},e.config.easyimage_styles);for(var t in o=a,r=(g=(l=e).config).easyimage_class,g={name:"easyimage",allowedContent:{figure:{classes:g.easyimage_sideClass},img:{attributes:"!src,srcset,alt,width,sizes"}},requiredContent:"figure; img[!src]",styleableElements:"figure",supportedTypes:new RegExp("image/("+p.join("|")+")","i"),loaderType:CKEDITOR.plugins.cloudservices.cloudServicesLoader,progressReporterType:CKEDITOR.plugins.imagebase.progressBar,upcasts:{figure:function(e){if((!r||e.hasClass(r))&&1===e.find("img",!0).length)return e}},init:function(){function i(e,a){var t=e.$;if(t.complete&&t.naturalWidth)return a(t.naturalWidth);e.once("load",function(){if(!t.naturalWidth)return t.src=t.src,i(e,a);a(t.naturalWidth)})}var e=this.parts.image,a=e&&e.$.complete&&!e.$.naturalWidth;(e&&!e.$.complete||a)&&(a&&(e.$.src=e.$.src),i(e,function(){l._.easyImageToolbarContext.toolbar.reposition()})),void 0!==(e=this.element.data("cke-upload-id"))&&(this.setData("uploadId",e),this.element.data("cke-upload-id",!1)),this.on("contextMenu",f),l.config.easyimage_class&&this.addClass(l.config.easyimage_class),this.on("uploadStarted",function(){var a=this;i(a.parts.image,function(e){a.parts.image.hasAttribute("width")||(a.editor.fire("lockSnapshot"),a.parts.image.setAttribute("width",e),a.editor.fire("unlockSnapshot"))})}),this.on("uploadDone",function(e){e=e.data.loader.responseData.response;var a=CKEDITOR.plugins.easyimage._parseSrcSet(e);this.parts.image.setAttributes({"data-cke-saved-src":e.default,src:e.default,srcset:a,sizes:"100vw"})}),this.on("uploadFailed",function(){alert(this.editor.lang.easyimage.uploadFailed)}),this._loadDefaultStyle()},_loadDefaultStyle:function(){var e,a=!1,t=l.config.easyimage_defaultStyle;for(e in o){var i=l.getCommand("easyimage"+c(e));!a&&i&&i.style&&-1!==CKEDITOR.tools.array.indexOf(i.style.group,"easyimage")&&this.checkStyleActive(i.style)&&(a=!0)}!a&&t&&l.getCommand("easyimage"+c(t))&&this.applyStyle(l.getCommand("easyimage"+c(t)).style)}},r&&(g.requiredContent+="(!"+r+")",g.allowedContent.figure.classes="!"+r+","+g.allowedContent.figure.classes),l.plugins.link&&(g=CKEDITOR.plugins.imagebase.addFeature(l,"link",g)),g=CKEDITOR.plugins.imagebase.addFeature(l,"upload",g),g=CKEDITOR.plugins.imagebase.addFeature(l,"caption",g),CKEDITOR.plugins.imagebase.addImageWidget(l,"easyimage",g),m=e,d=new RegExp("<img[^>]*\\ssrc=[\\'\\\"]?data:image/("+p.join("|")+");base64,","i"),m.on("paste",function(e){if(!m.isReadOnly&&d.test(e.data.dataValue)){e=e.data;var a,t,i,s,n=document.implementation.createHTMLDocument(""),n=new CKEDITOR.dom.element(n.body),l=m.widgets.registered.easyimage,o=0;for(n.data("cke-editable",1),n.appendHtml(e.dataValue),t=n.find("img"),s=0;s<t.count();s++){var r=(a=(i=t.getItem(s)).getAttribute("src"))&&"data:"==a.substring(0,5),g=null===i.data("cke-realelement");r&&g&&!i.isReadOnly(1)&&(1<++o&&((r=m.getSelection().getRanges())[0].enlarge(CKEDITOR.ENLARGE_ELEMENT),r[0].collapse(!1)),a.match(/image\/([a-z]+?);/i),r=l._spawnLoader(m,a,l),(a=l._insertWidget(m,l,a,!1,{uploadId:r.id})).data("cke-upload-id",r.id),a.replace(i))}e.dataValue=n.getHtml()}}),u(e,a),e.ui.addButton("EasyImageAlt",{label:e.lang.easyimage.commands.altText,command:"easyimageAlt",toolbar:"easyimage,3"}),a)e.ui.addButton("EasyImage"+c(t),{label:a[t].label,command:"easyimage"+c(t),toolbar:"easyimage,99",icon:a[t].icon,iconHiDpi:a[t].iconHiDpi});n=(s=e).config.easyimage_toolbar,s.plugins.contextmenu&&(n.split&&(n=n.split(",")),s.addMenuGroup("easyimage"),CKEDITOR.tools.array.forEach(n,function(e){e=s.ui.items[e],s.addMenuItem(e.name,{label:e.label,command:e.command,group:"easyimage"})})),a=e.config.easyimage_toolbar,e._.easyImageToolbarContext=e.balloonToolbars.create({buttons:a.join?a.join(","):a,widgets:["easyimage"]}),(i=e).ui.addButton("EasyImageUpload",{label:i.lang.easyimage.commands.upload,command:"easyimageUpload",toolbar:"insert,1"}),i.addCommand("easyimageUpload",{exec:function(){var e=CKEDITOR.dom.element.createFromHtml('<input type="file" accept="image/*" multiple="multiple">');e.once("change",function(e){(e=e.data.getTarget()).$.files.length&&i.fire("paste",{method:"paste",dataValue:"",dataTransfer:new CKEDITOR.plugins.clipboard.dataTransfer({files:e.$.files})})}),e.$.click()}})}var i,s,n,m,d,l,o,r,g}}),CKEDITOR.config.easyimage_class="easyimage",CKEDITOR.config.easyimage_styles={},CKEDITOR.config.easyimage_defaultStyle="full",CKEDITOR.config.easyimage_toolbar=["EasyImageFull","EasyImageSide","EasyImageAlt"]}();